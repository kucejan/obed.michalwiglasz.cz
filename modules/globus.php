<?php

/*
<div class="pl-4 lg:pl-8 xl:pl-14 min-w-[20rem]">
   <!--[-->
   <h2 class="font-semibold mb-4"> Restaurační dnešní nabídka </h2>
   <!--]--><!--[--><!--[--><!----><!--]--><!--[--><!----><!--]--><!--[--><!----><!--]--><!--[--><!----><!--]--><!--[-->
   <div class="space-y-2">
      <!--[-->
      <div class="flex gap-2 lg:gap-4 w-full pr-5 lg:pr-0">
         <span class="min-w-[2.5rem] lg:min-w-[3.125rem]">0,33 l</span>
         <span class="flex-auto break-all">
            Zabijačková <!----><!--[--><!--[--><!----><!--]--><!--[--><!----><!--]--><!--[--><!----><!--]--><!--]-->
         </span>
         <span class="min-w-[2.5rem] lg:min-w-[3.125rem] text-end">35&nbsp;Kč</span>
      </div>
      <div class="flex gap-2 lg:gap-4 w-full pr-5 lg:pr-0">
         <span class="min-w-[2.5rem] lg:min-w-[3.125rem]">0,33 l</span>
         <span class="flex-auto break-all">
            Kuřecí vývar s  nudlemi <!--[--> (1,1a,9) <!--]--><!--[--><!--[--><!----><!--]--><!--[--><!----><!--]--><!--[--><!----><!--]--><!--]-->
         </span>
         <span class="min-w-[2.5rem] lg:min-w-[3.125rem] text-end">35&nbsp;Kč</span>
      </div>
      <div class="flex gap-2 lg:gap-4 w-full pr-5 lg:pr-0">
         <span class="min-w-[2.5rem] lg:min-w-[3.125rem]">350 g</span>
         <span class="flex-auto break-all">
            Pečené kachní stehno s červeným zelím, bramborové knedlíky <!--[--> (1,1a,3) <!--]--><!--[--><!--[--><!----><!--]--><!--[--><!----><!--]--><!--[--><!----><!--]--><!--]-->
         </span>
         <span class="min-w-[2.5rem] lg:min-w-[3.125rem] text-end">209&nbsp;Kč</span>
      </div>
      <div class="flex gap-2 lg:gap-4 w-full pr-5 lg:pr-0">
         <span class="min-w-[2.5rem] lg:min-w-[3.125rem]">1 ks</span>
         <span class="flex-auto break-all">
            Alpský knedlík s vanilkovým krémem, cukrem a mákem <!--[--> (1,1a,7) <!--]--><!--[--><!--[--><!----><!--]--><!--[--><!----><!--]--><!--[-->
            <span class="nuxt-icon [&amp;>svg]:inline [&amp;>svg]:-translate-y-[2px] text-gray-600" aria-label="Vegetariánské">
               <svg width="15" height="15" viewBox="0 0 15 15" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <path d="M9.79004 3.54305L12.1367 5.88972L14.498 5.02439C14.8207 4.90705 14.9087 4.48172 14.674 4.24705C14.5714 4.14439 14.4394 4.10039 14.2927 4.11505L12.562 4.27639L13.6914 2.70705C13.8234 2.51639 13.8087 2.26705 13.6474 2.09105L13.6034 2.04705C13.442 1.88572 13.178 1.87105 12.9874 2.00305L11.418 3.13239L11.5647 1.38705C11.5794 1.25505 11.5207 1.10839 11.4327 1.00572C11.242 0.815052 10.934 0.829719 10.7727 1.00572C10.7287 1.04972 10.6847 1.10839 10.6554 1.18172L9.79004 3.54305Z" fill="#4A4A4A"></path>
                  <path d="M11.6676 6.28603L9.39422 4.0127C8.76355 3.38203 7.69289 3.4847 7.20889 4.2327L6.84222 4.79003L8.93955 6.88736C9.07155 7.01936 9.07155 7.22469 8.93955 7.35669L8.77822 7.51803C8.64622 7.65003 8.44089 7.65003 8.30889 7.51803L6.34355 5.53803L3.30755 10.158L4.51022 11.3607C4.64222 11.4927 4.64222 11.698 4.51022 11.83L4.36355 11.9767C4.23155 12.1087 4.02622 12.1087 3.89422 11.9767L2.82355 10.906L1.00489 13.6487C0.564885 14.3234 1.35689 15.1154 2.03155 14.6754L7.45822 11.0967L6.05022 9.68869C5.91822 9.55669 5.91822 9.35136 6.05022 9.21936L6.21155 9.05803C6.34355 8.92603 6.54889 8.92603 6.68089 9.05803L8.20622 10.5834L11.4476 8.4567C12.1956 7.97269 12.2982 6.9167 11.6676 6.28603Z" fill="#4A4A4A"></path>
               </svg>
            </span>
            <!--]--><!--]-->
         </span>
         <span class="min-w-[2.5rem] lg:min-w-[3.125rem] text-end">89&nbsp;Kč</span>
      </div>
      <div class="flex gap-2 lg:gap-4 w-full pr-5 lg:pr-0">
         <span class="min-w-[2.5rem] lg:min-w-[3.125rem]">100 g</span>
         <span class="flex-auto break-all">
            Segedínský guláš, kynuté knedlíky <!--[--> (6,7,10) <!--]--><!--[--><!--[-->
            <span class="nuxt-icon [&amp;>svg]:inline [&amp;>svg]:-translate-y-[2px] text-gray-600" aria-label="Bezlepek">
               <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <path d="M8 0C12.4156 0 16 3.58442 16 8C16 12.4156 12.4156 16 8 16C3.58442 16 0 12.4156 0 8C0 3.58442 3.58442 0 8 0ZM8 1.16017C4.22511 1.16017 1.16017 4.22511 1.16017 8C1.16017 9.67965 1.76623 11.2208 2.78788 12.3983L4.4329 10.7532C4.60606 11.0996 4.84848 11.3766 5.17749 11.6537L3.60173 13.2294C4.77922 14.2338 6.32035 14.8398 8 14.8398C11.7749 14.8398 14.8398 11.7749 14.8398 7.98268C14.8398 6.32035 14.2338 4.77922 13.2294 3.58442L11.4632 5.35065C11.6537 4.84848 11.6017 4.13853 11.4459 3.72294L12.3983 2.77056C11.2208 1.76623 9.67965 1.16017 8 1.16017ZM8 5.47186C8.21818 5.47186 8.40831 5.64017 8.44416 5.85056L8.45022 5.92208V13.7143C8.45022 13.9567 8.24242 14.1645 8 14.1645C7.78182 14.1645 7.59169 13.9962 7.55584 13.7858L7.54978 13.7143V5.92208C7.54978 5.67965 7.75758 5.47186 8 5.47186ZM11.29 9.33333C11.3939 9.92208 11.2208 10.5455 10.7706 11.013C10.3377 11.4805 9.71429 11.6883 9.12554 11.6364C9.02164 11.0476 9.19481 10.4242 9.64502 9.95671C10.0779 9.48918 10.7013 9.28139 11.29 9.33333ZM6.35498 9.95671C6.78788 10.4242 6.96104 11.0476 6.87446 11.6364C6.28571 11.6883 5.66234 11.4805 5.22944 11.013C4.79654 10.5455 4.62338 9.92208 4.70996 9.33333C5.2987 9.28139 5.92208 9.48918 6.35498 9.95671ZM11.1861 6.77056C11.29 7.35931 11.1169 7.98268 10.6667 8.45022C10.2338 8.91775 9.61039 9.12554 9.02165 9.07359C8.91775 8.48485 9.09091 7.86147 9.54113 7.39394C9.97403 6.90909 10.5974 6.7013 11.1861 6.77056ZM6.45887 7.37662C6.89178 7.84416 7.06493 8.46753 6.97835 9.05628C6.38961 9.10822 5.76623 8.90043 5.33333 8.4329C4.90043 7.96537 4.72727 7.34199 4.81385 6.75325C5.4026 6.7013 6.02597 6.90909 6.45887 7.37662ZM5.00433 4.12121C5.61039 4.1039 6.19913 4.36364 6.5974 4.8658C6.99567 5.36797 7.11688 6.00866 6.97835 6.58009C6.38961 6.5974 5.78355 6.33766 5.38528 5.8355C4.98701 5.33333 4.8658 4.69264 5.00433 4.12121ZM10.9957 4.1039C11.1342 4.67532 11.0303 5.31602 10.6147 5.81818C10.2165 6.32035 9.61039 6.58009 9.02165 6.56277C8.88312 5.99134 8.98701 5.35065 9.4026 4.84848C9.80087 4.36364 10.3896 4.1039 10.9957 4.1039ZM8 1.92208C8.46753 2.28571 8.77922 2.85714 8.77922 3.49784C8.77922 4.13853 8.46753 4.70996 8 5.07359C7.53247 4.70996 7.22078 4.13853 7.22078 3.49784C7.22078 2.85714 7.53247 2.28571 8 1.92208Z" fill="#4A4A4A"></path>
               </svg>
            </span>
            <!--]--><!--[--><!----><!--]--><!--[--><!----><!--]--><!--]-->
         </span>
         <span class="min-w-[2.5rem] lg:min-w-[3.125rem] text-end">145&nbsp;Kč</span>
      </div>
      <div class="flex gap-2 lg:gap-4 w-full pr-5 lg:pr-0">
         <span class="min-w-[2.5rem] lg:min-w-[3.125rem]">100 g</span>
         <span class="flex-auto break-all">
            Hrachová kaše s uzeným masem a okurkou <!--[--> (1,1a) <!--]--><!--[--><!--[--><!----><!--]--><!--[--><!----><!--]--><!--[--><!----><!--]--><!--]-->
         </span>
         <span class="min-w-[2.5rem] lg:min-w-[3.125rem] text-end">89&nbsp;Kč</span>
      </div>
      <div class="flex gap-2 lg:gap-4 w-full pr-5 lg:pr-0">
         <span class="min-w-[2.5rem] lg:min-w-[3.125rem]">450 g</span>
         <span class="flex-auto break-all">
            Zapečené francouzské brambory s uzeným masem <!--[--> (3,7) <!--]--><!--[--><!--[--><!----><!--]--><!--[--><!----><!--]--><!--[--><!----><!--]--><!--]-->
         </span>
         <span class="min-w-[2.5rem] lg:min-w-[3.125rem] text-end">89&nbsp;Kč</span>
      </div>
      <div class="flex gap-2 lg:gap-4 w-full pr-5 lg:pr-0">
         <span class="min-w-[2.5rem] lg:min-w-[3.125rem]">370 g</span>
         <span class="flex-auto break-all">
            Špenátové robi rizoto <!--[--> (1,1a,7) <!--]--><!--[--><!--[--><!----><!--]--><!--[--><!----><!--]--><!--[-->
            <span class="nuxt-icon [&amp;>svg]:inline [&amp;>svg]:-translate-y-[2px] text-gray-600" aria-label="Vegetariánské">
               <svg width="15" height="15" viewBox="0 0 15 15" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <path d="M9.79004 3.54305L12.1367 5.88972L14.498 5.02439C14.8207 4.90705 14.9087 4.48172 14.674 4.24705C14.5714 4.14439 14.4394 4.10039 14.2927 4.11505L12.562 4.27639L13.6914 2.70705C13.8234 2.51639 13.8087 2.26705 13.6474 2.09105L13.6034 2.04705C13.442 1.88572 13.178 1.87105 12.9874 2.00305L11.418 3.13239L11.5647 1.38705C11.5794 1.25505 11.5207 1.10839 11.4327 1.00572C11.242 0.815052 10.934 0.829719 10.7727 1.00572C10.7287 1.04972 10.6847 1.10839 10.6554 1.18172L9.79004 3.54305Z" fill="#4A4A4A"></path>
                  <path d="M11.6676 6.28603L9.39422 4.0127C8.76355 3.38203 7.69289 3.4847 7.20889 4.2327L6.84222 4.79003L8.93955 6.88736C9.07155 7.01936 9.07155 7.22469 8.93955 7.35669L8.77822 7.51803C8.64622 7.65003 8.44089 7.65003 8.30889 7.51803L6.34355 5.53803L3.30755 10.158L4.51022 11.3607C4.64222 11.4927 4.64222 11.698 4.51022 11.83L4.36355 11.9767C4.23155 12.1087 4.02622 12.1087 3.89422 11.9767L2.82355 10.906L1.00489 13.6487C0.564885 14.3234 1.35689 15.1154 2.03155 14.6754L7.45822 11.0967L6.05022 9.68869C5.91822 9.55669 5.91822 9.35136 6.05022 9.21936L6.21155 9.05803C6.34355 8.92603 6.54889 8.92603 6.68089 9.05803L8.20622 10.5834L11.4476 8.4567C12.1956 7.97269 12.2982 6.9167 11.6676 6.28603Z" fill="#4A4A4A"></path>
               </svg>
            </span>
            <!--]--><!--]-->
         </span>
         <span class="min-w-[2.5rem] lg:min-w-[3.125rem] text-end">69&nbsp;Kč</span>
      </div>
      <div class="flex gap-2 lg:gap-4 w-full pr-5 lg:pr-0">
         <span class="min-w-[2.5rem] lg:min-w-[3.125rem]">1 ks</span>
         <span class="flex-auto break-all">
            Pečený pstruh se slaninovou omáčkou bramborová kaše s máslem <!--[--> (4,7) <!--]--><!--[--><!--[--><!----><!--]--><!--[--><!----><!--]--><!--[--><!----><!--]--><!--]-->
         </span>
         <span class="min-w-[2.5rem] lg:min-w-[3.125rem] text-end">159&nbsp;Kč</span>
      </div>
      <div class="flex gap-2 lg:gap-4 w-full pr-5 lg:pr-0">
         <span class="min-w-[2.5rem] lg:min-w-[3.125rem]">150 g</span>
         <span class="flex-auto break-all">
            Vepřový řízek z kotlety, bramborová kaše s máslem <!--[--> (1,1a,1b,1c,3,6,7) <!--]--><!--[--><!--[--><!----><!--]--><!--[--><!----><!--]--><!--[--><!----><!--]--><!--]-->
         </span>
         <span class="min-w-[2.5rem] lg:min-w-[3.125rem] text-end">119&nbsp;Kč</span>
      </div>
      <!--]-->
   </div>
   <!--]--><!--[--><!----><!--]--><!--[--><!----><!--]--><!--]--><!--[-->
   <a href="https://www.globus.cz/brno/sluzby-a-produkty/restaurace#klasicke-menu" class="btn btn-secondary btn-sm mt-4 shadow">
      <!--[--> Menu na celý týden <!--]-->
   </a>
   <!--]-->
</div>
*/

class Globus extends LunchMenuSource
{
	public $icon = 'globus.svg';

	public function __construct($title, $link) {
		$this->title = $title;
		$this->link = $link;
	}

	public function getTodaysMenu($todayDate, $cacheSourceExpires)
	{
		$cached = $this->downloadHtml($cacheSourceExpires);
		$result = new LunchMenuResult($cached['stored']);

		/** @var simple_html_dom */
		$html = $cached['html'];
		//$html = str_get_html(file_get_contents(__DIR__ . '/globus.html'));

		// find h2 which contains 'Restaurační dnešní nabídka'
		$menuH2 = null;
		foreach ($html->find("h2.font-semibold") as $h2) {
			if (mb_strpos($h2->plaintext, 'Restaurační dnešní nabídka') !== FALSE) {
				$menuH2 = $h2;
				break;
			}
		}

		if (!$menuH2) {
			throw new ScrapingFailedException("Proper h2.font-semibold not found");
		}

		// iterate over flex gap-2
		foreach ($menuH2->parent->find("div.flex") as $flex) {
			$quantity = $flex->find("span", 0)->plaintext;
			$what = $flex->find("span", 1)->plaintext;
			$price = html_entity_decode($flex->find("span", 2)->plaintext);

			$result->dishes[] = new Dish($what, $price, $quantity);
		}

		return $result;
	}
}
